<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Деталі контакту</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css">
</head>
<body>
<div class="container mt-5">
  <h1>Деталі контакту</h1>

  <div class="mb-3">
    <strong>Ім'я:</strong> <span th:text="${contact.firstName}"></span>
  </div>
  <div class="mb-3">
    <strong>Прізвище:</strong> <span th:text="${contact.lastName}"></span>
  </div>
  <div class="mb-3">
    <strong>Email:</strong> <span th:text="${contact.email}"></span>
  </div>
  <div class="mb-3">
    <strong>Номер:</strong> <span th:text="${contact.phone}"></span>
  </div>

  <a th:href="@{/contacts/edit/{id}(id=${contact.id})}" class="btn btn-warning me-2">Редагувати контакт</a>
  <a th:href="@{/clients/{id}(id=${contact.clientId})}" class="btn btn-secondary me-2">Назад до клієнта</a>
  <form th:action="@{/contacts/delete/{id}(id=${contact.id})}" method="post" style="display:inline;">
    <input type="hidden" name="clientId" th:value="${contact.clientId}" />
    <input type="hidden" name="_method" value="delete" />
    <button type="submit" class="btn btn-danger" onclick="return confirm('Ви впевнені, що хочете видалити цей контакт?')">Видалити</button>
  </form>

  <h2 class="mt-5">Завдання для контакту</h2>
  <a th:href="@{/tasks/create/{contactId}(contactId=${contact.id})}" class="btn btn-success mt-3">Створити завдання</a>

  <table class="table mt-3">
    <thead>
    <tr>
      <th>ID</th>
      <th>Опис</th>
      <th>Статус</th>
      <th>Дата завершення</th>
      <th>Призначений контакт</th>
      <th>Дії</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="task : ${tasks}">
      <td th:text="${task.id}"></td>
      <td th:text="${task.description}"></td>
      <td th:text="${task.status.displayName}"></td>
      <td th:text="${task.dueDate}"></td>
      <td>
        <span th:text="${contact.firstName} + ' ' + ${contact.lastName}"></span>
      </td>
      <td>
        <div class="d-flex align-items-center">
          <form th:action="@{/tasks/update-contact}" method="post" class="me-2">
            <input type="hidden" name="taskId" th:value="${task.id}" />
            <select name="contactId" class="form-select" required>
              <option th:each="contact : ${allContacts}"
                      th:value="${contact.id}"
                      th:text="${contact.firstName} + ' ' + ${contact.lastName}"
                      th:selected="${task.contactId == contact.id}"></option>
            </select>
            <button type="submit" class="btn btn-primary mt-2">Переназначити</button>
          </form>

          <!-- Форма для зміни статусу -->
          <form th:action="@{/tasks/update-status}" method="post" class="me-2">
            <input type="hidden" name="taskId" th:value="${task.id}" />
            <select name="status" class="form-select" required>
              <option th:each="status : ${statuses}"
                      th:value="${status.name()}"
                      th:text="${status.displayName}"
                      th:selected="${task.status == status}"></option>
            </select>
            <button type="submit" class="btn btn-secondary mt-2">Змінити статус</button>
          </form>

          <form th:action="@{/tasks/delete/{taskId}(taskId=${task.id})}" method="post">
            <button type="submit" class="btn btn-danger" onclick="return confirm('Ви впевнені, що хочете видалити це завдання?')">Видалити</button>
          </form>
        </div>
      </td>
    </tr>
    </tbody>
  </table>
</div>
<div th:replace="notification.html"></div>
</body>
</html>
